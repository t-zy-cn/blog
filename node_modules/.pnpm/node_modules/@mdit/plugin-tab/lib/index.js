import{escapeHtml as A}from"@mdit/helper";const I=3,y="@tab",T=y.length,R=(n,b)=>(t,a,k,_)=>{if(b.state!==n)return!1;const c=t.bMarks[a]+t.tShift[a],d=t.eMarks[a],r=t.sCount[a];if(t.src.charAt(c)!=="@")return!1;for(let p=0;p<T;p++)if(y[p]!==t.src[c+p])return!1;const e=t.src.slice(c,c+T),s=t.src.slice(c+T,d);if(_)return!0;let i=a+1,u=!1;for(;i<k;i++){const p=t.bMarks[i]+t.tShift[i];if(t.sCount[i]===r&&t.src[p]==="@"){let m=!0;for(let h=0;h<y.length;h++)if(y[h]!==t.src[p+h]){m=!1;break}if(m){u=!0;break}}}const $=t.parentType,f=t.lineMax,o=t.blkIndent;t.parentType="tab",t.lineMax=i-(u?1:0),t.blkIndent=r;const l=t.push(`${n}_tab_open`,"",1),[,M,x]=/^(.*?)(?:(?<!\\)#([^#]*))?$/.exec(s.replace(/^:active/,""));l.block=!0,l.markup=e,l.info=M.trim().replace(/\\#/g,"#"),l.meta={active:s.includes(":active")},x&&(l.meta.id=x.trim()),l.map=[a,i-(u?1:0)],t.md.block.tokenize(t,a+1,i+(u?0:1));const v=t.push(`${n}_tab_close`,"",-1);return v.block=!0,v.markup="",t.parentType=$,t.lineMax=f,t.blkIndent=o,t.line=i+(u?0:1),!0},J=(n,b)=>(t,a,k,_)=>{const c=t.bMarks[a]+t.tShift[a],d=t.eMarks[a],r=t.sCount[a];if(t.src[c]!==":")return!1;let e=c+1;for(;e<=d&&t.src[e]===":";)e++;const s=e-c;if(s<I)return!1;const i=t.src.slice(c,e),u=t.src.slice(e,d),[$,f=""]=u.split("#",2);if($.trim()!==n)return!1;if(_)return!0;let o=a+1,l=!1;for(;o<k;o++){const g=t.bMarks[o]+t.tShift[o],S=t.eMarks[o];if(g<S&&t.sCount[o]<r)break;if(t.sCount[o]===r&&t.src[g]===":"){for(e=g+1;e<=S&&t.src[e]===":";e++);if(e-g>=s&&(e=t.skipSpaces(e),e>=S)){l=!0;break}}}const M=t.parentType,x=t.lineMax,v=t.blkIndent,p=b.state;t.parentType=`${n}_tabs`,t.lineMax=o-(l?1:0),t.blkIndent=r;const m=t.push(`${n}_tabs_open`,"",1);m.markup=i,m.block=!0,m.info=$,m.meta={id:f.trim()},m.map=[a,o-(l?1:0)],b.state=n,t.md.block.tokenize(t,a+1,o-(l?1:0)),b.state=p;const h=t.push(`${n}_tabs_close`,"",-1);return h.markup=t.src.slice(c,e),h.block=!0,t.parentType=M,t.lineMax=x,t.blkIndent=v,t.line=o+(l?1:0),!0},q=n=>(b,t)=>{const a=[];let k=-1,_=!1,c=0;for(let d=t+1;d<b.length;d++){const{block:r,meta:e,type:s,info:i}=b[d];if(r){if(s===`${n}_tabs_open`){c++;continue}if(s===`${n}_tabs_close`){if(c===0)break;c--;continue}if(c>0)continue;if(s===`${n}_tab_open`){_=!0,e.index=a.length,e.active&&(k===-1?k=a.length:e.active=!1),a.push({title:i,index:e.index,...e.id?{id:e.id}:{}});continue}if(s===`${n}_tab_close`)continue;_||(b[d].type=`${n}_tabs_empty`,b[d].hidden=!0)}}return{active:k,data:a.map((d,r)=>({...d,active:r===k}))}},z=(n,b)=>{const{info:t,meta:a}=n[b];return{title:t,index:a.index,...a.id?{id:a.id}:{},isActive:!!a.active}},C={state:null},j=(n,b)=>{const{name:t="tabs",openRender:a=(r,e,s,i,u,$)=>{const{active:f,data:o}=r,l=e[s];l.attrJoin("class",`${t}-tabs-wrapper`),l.meta.id&&l.attrJoin("data-id",l.meta.id);const M=o.map(({title:x,id:v},p)=>`<button type="button" class="${t}-tab-button${f===p?" active":""}" data-tab="${p}"${v?` data-id="${A(v)}"`:""}${f===p?" data-active":""}>${A(x)}</button>`);return`<div${$.renderAttrs(l)}>
  <div class="${t}-tabs-header">
    ${M.join(`
    `)}
  </div>
  <div class="${t}-tabs-container">
`},closeRender:k=()=>`  </div>
</div>
`,tabOpenRender:_=(r,e,s,i,u,$)=>{const f=e[s];return f.attrJoin("class",`${t}-tab-content${r.isActive?" active":""}`),f.attrSet("data-index",r.index.toString()),r.id&&f.attrSet("data-id",r.id.toString()),r.isActive&&f.attrJoin("data-active",""),`<div${$.renderAttrs(e[s])}>
`},tabCloseRender:c=()=>`</div>
`}=b??{},d=q(t);n.block.ruler.before("fence",`${t}_tabs`,J(t,C),{alt:["paragraph","reference","blockquote","list"]}),n.block.ruler.before("paragraph",`${t}_tab`,R(t,C),{alt:["paragraph","reference","blockquote","list"]}),n.renderer.rules[`${t}_tabs_open`]=(r,e,s,i,u)=>{const $=d(r,e);return a($,r,e,s,i,u)},n.renderer.rules[`${t}_tabs_close`]=k,n.renderer.rules[`${t}_tab_open`]=(r,e,...s)=>{const i=z(r,e);return _(i,r,e,...s)},n.renderer.rules[`${t}_tab_close`]=c};export{j as tab};
//# sourceMappingURL=index.js.map
