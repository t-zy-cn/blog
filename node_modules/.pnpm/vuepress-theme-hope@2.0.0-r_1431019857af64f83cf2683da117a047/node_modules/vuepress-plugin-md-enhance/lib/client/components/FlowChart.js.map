{"version":3,"file":"FlowChart.js","sources":["../../../src/client/components/FlowChart.ts"],"sourcesContent":["import { LoadingIcon, decodeData } from \"@vuepress/helper/client\";\nimport { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Chart } from \"flowchart.ts\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  toRefs,\n  watch,\n} from \"vue\";\nimport { onContentUpdated } from \"vuepress/client\";\n\nimport { flowchartPresets } from \"../utils/index.js\";\n\nimport \"../styles/flowchart.scss\";\n\nexport default defineComponent({\n  name: \"FlowChart\",\n\n  props: {\n    /**\n     * Flowchart code content\n     *\n     * 流程图代码内容\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Flowchart id\n     *\n     * 流程图 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Flowchart preset\n     *\n     * 流程图预设\n     */\n    preset: {\n      type: String as PropType<\"ant\" | \"pie\" | \"vue\">,\n      default: \"vue\",\n    },\n  },\n\n  setup(props) {\n    const { code, id, preset } = toRefs(props);\n    const element = shallowRef<HTMLDivElement>();\n\n    const loaded = ref(false);\n    const scale = ref(1);\n\n    let flowchart: Chart | null = null;\n\n    const getScale = (width: number): number =>\n      width < 419 ? 0.8 : width > 1280 ? 1 : 0.9;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        if (flowchart) {\n          const newScale = getScale(window.innerWidth);\n\n          if (scale.value !== newScale) {\n            scale.value = newScale;\n\n            flowchart.draw(props.id, {\n              ...flowchartPresets[props.preset],\n              scale: newScale,\n            });\n          }\n        }\n      }, 100),\n    );\n\n    const destroyFlowChart = (): void => {\n      flowchart?.clean();\n      flowchart = null;\n    };\n\n    const renderFlowChart = async (): Promise<void> => {\n      if (__VUEPRESS_SSR__) return;\n\n      const { parse } = await import(\n        /* webpackChunkName: \"flowchart\" */ \"flowchart.ts\"\n      );\n\n      flowchart = parse(decodeData(code.value));\n\n      // Update scale\n      scale.value = getScale(window.innerWidth);\n\n      loaded.value = true;\n\n      // Draw svg to #id\n      flowchart.draw(props.id, {\n        ...flowchartPresets[props.preset],\n        scale: scale.value,\n      });\n    };\n\n    onContentUpdated(async (reason) => {\n      if (reason === \"mounted\") await renderFlowChart();\n    });\n\n    onMounted(() => {\n      if (!__VUEPRESS_DEV__) return;\n\n      watch(\n        [code, id, preset],\n        async () => {\n          destroyFlowChart();\n          await nextTick();\n          await renderFlowChart();\n        },\n        { flush: \"post\" },\n      );\n    });\n\n    onUnmounted(destroyFlowChart);\n\n    return (): (VNode | null)[] => [\n      loaded.value\n        ? null\n        : h(LoadingIcon, { class: \"flowchart-loading\", height: 192 }),\n      h(\"div\", {\n        ref: element,\n        class: [\"flowchart-wrapper\", props.preset],\n        id: props.id,\n        style: {\n          display: loaded.value ? \"block\" : \"none\",\n        },\n      }),\n    ];\n  },\n});\n"],"names":["defineComponent","props","code","id","preset","toRefs","element","shallowRef","loaded","ref","scale","flowchart","getScale","width","useEventListener","useDebounceFn","newScale","flowchartPresets","destroyFlowChart","renderFlowChart","parse","decodeData","onContentUpdated","reason","onMounted","watch","nextTick","onUnmounted","h","LoadingIcon"],"mappings":"iZAqBA,IAAeA,EAAAA,EAAgB,CAC7B,KAAM,YAEN,MAAO,CAML,KAAM,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOrC,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,OAAQ,CACN,KAAM,OACN,QAAS,KACX,CACF,EAEA,MAAMC,EAAO,CACX,KAAM,CAAE,KAAAC,EAAM,GAAAC,EAAI,OAAAC,CAAO,EAAIC,EAAOJ,CAAK,EACnCK,EAAUC,IAEVC,EAASC,EAAI,EAAK,EAClBC,EAAQD,EAAI,CAAC,EAEnB,IAAIE,EAA0B,KAE9B,MAAMC,EAAYC,GAChBA,EAAQ,IAAM,GAAMA,EAAQ,KAAO,EAAI,GAEzCC,EACE,SACAC,EAAc,IAAM,CAClB,GAAIJ,EAAW,CACb,MAAMK,EAAWJ,EAAS,OAAO,UAAU,EAEvCF,EAAM,QAAUM,IAClBN,EAAM,MAAQM,EAEdL,EAAU,KAAKV,EAAM,GAAI,CACvB,GAAGgB,EAAiBhB,EAAM,MAAM,EAChC,MAAOe,CACT,CAAC,EAEL,CACF,EAAG,GAAG,CACR,EAEA,MAAME,EAAmB,IAAY,CACnCP,GAAW,MAAM,EACjBA,EAAY,IACd,EAEMQ,EAAkB,SAA2B,CACjD,GAAI,iBAAkB,OAEtB,KAAM,CAAE,MAAAC,CAAM,EAAI,KAAM,QACc,cACtC,EAEAT,EAAYS,EAAMC,EAAWnB,EAAK,KAAK,CAAC,EAGxCQ,EAAM,MAAQE,EAAS,OAAO,UAAU,EAExCJ,EAAO,MAAQ,GAGfG,EAAU,KAAKV,EAAM,GAAI,CACvB,GAAGgB,EAAiBhB,EAAM,MAAM,EAChC,MAAOS,EAAM,KACf,CAAC,CACH,EAEA,OAAAY,EAAiB,MAAOC,GAAW,CAC7BA,IAAW,WAAW,MAAMJ,GAClC,CAAC,EAEDK,EAAU,IAAM,CACT,kBAELC,EACE,CAACvB,EAAMC,EAAIC,CAAM,EACjB,SAAY,CACVc,EACA,EAAA,MAAMQ,IACN,MAAMP,GACR,EACA,CAAE,MAAO,MAAO,CAClB,CACF,CAAC,EAEDQ,EAAYT,CAAgB,EAErB,IAAwB,CAC7BV,EAAO,MACH,KACAoB,EAAEC,EAAa,CAAE,MAAO,oBAAqB,OAAQ,GAAI,CAAC,EAC9DD,EAAE,MAAO,CACP,IAAKtB,EACL,MAAO,CAAC,oBAAqBL,EAAM,MAAM,EACzC,GAAIA,EAAM,GACV,MAAO,CACL,QAASO,EAAO,MAAQ,QAAU,MACpC,CACF,CAAC,CACH,CACF,CACF,CAAC"}